summary: Test enabling default experiments
execute: |
  oxidizr enable --yes

  apt list rust-coreutils | MATCH installed
  while read p; do
    util_path="$(which $p)"
    util_dir="$(dirname "$util_path")"
    ls -la "$util_path"| MATCH "$util_path -> /usr/bin/coreutils"
    ls -la "$util_dir/.$p.oxidizr.bak" || echo "No backup file for $util_path"
    $util_path --help | NOMATCH "https://www.gnu.org/software/coreutils"
  done < ../rust-coreutils-bins.txt

  apt list rust-findutils | MATCH installed
  while read p; do
    util_path="$(which $p)"
    util_dir="$(dirname "$util_path")"
    ls -la "$util_path"| MATCH "$util_path -> /usr/lib/cargo/bin/findutils/$p"
    ls -la "$util_dir/.$p.oxidizr.bak" || echo "No backup file for $util_path"
    $util_path --help | NOMATCH "https://www.gnu.org/software/coreutils"
  done < ../rust-findutils-bins.txt

  if [[ "$(lsb_release -rs)" != "24.04" ]]; then
    apt list rust-diffutils | MATCH installed
    while read p; do
      util_path="$(which $p)"
      util_dir="$(dirname "$util_path")"
      ls -la "$util_path"| MATCH "$util_path -> /usr/lib/cargo/bin/diffutils/$p"
      ls -la "$util_dir/.$p.oxidizr.bak" || echo "No backup file for $util_path"
      $util_path --help | NOMATCH "https://www.gnu.org/software/coreutils"
    done < ../rust-diffutils-bins.txt
  fi

restore: |
  if [[ -z "${CI:-}" ]]; then
    oxidizr disable  --yes
  fi
